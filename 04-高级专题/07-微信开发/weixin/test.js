!function () { let e = $(".cityPage"), t = $(".questionPage"), i = $(".resultPage"), n = $(".contactPage"), o = {}, c = "", l = null, s = null, r = ""; function a () { let e = new Object, t = location.search.substring(1).split("&"); for (let i = 0; i < t.length; i++) { let n = t[i].indexOf("="); if (-1 == n) continue; let o = t[i].substring(0, n), c = t[i].substring(n + 1); c = decodeURIComponent(c), e[o] = c } return e } let u = a(); function d () { u = a(), console.log("进入界面url：" + document.location.href), console.log("进入界面城市参数：" + u.city); let d = $(".cityContainer"), p = $(".searchList"); t.hide(), i.hide(), n.hide(), p.hide(); let g = ""; for (let e = 0; e < CITY_LIST.length; e++) { let t = CITY_LIST[e].name.toString(), i = CITY_LIST[e].url.toString(); o[t] = i, g += '<div class="cityBox">' + t + "</div>" } if (d.html(g), u.city) { for (let e = 0; e < CITY_LIST.length; e++)if (CITY_LIST[e].namePy == u.city) { c = CITY_LIST[e].name; break } c ? (h(c), e.hide(), t.show(), $(".curCity").text(c)) : alert("无指定城市数据，请手动选择城市") } $(".cityPage .cityInput").on("input", (function () { r = setTimeout(function (e, t) { let i = 0; return function (...n) { let o = +new Date; o - i > t && (i = o, e.apply(this, n)) } }(() => { let i = $(this).val(); if (i) { let e = ""; for (let t = 0; t < CITY_LIST.length; t++) { let n = CITY_LIST[t].name, o = CITY_LIST[t].namePy; (n.indexOf(i) > -1 || o.indexOf(i) > -1) && (e += "<div>" + n + "</div>") } "" == e && (e = "没有符合的城市，请尝试更改搜索词"), $(".cityList").html(e), p.show() } else $(".cityList").empty(), p.hide(); $(".cityPage .cityList div").on("click", (function () { c = $(this).html(), h(c), e.hide(), t.show(), $(".curCity").text(c) })) }, 500), 500) })), $(".cityPage .cityInput").on("blur", (function () { setTimeout((function () { clearTimeout(r), $(".cityList").empty(), p.hide() }), 500) })), $(".cityPage .cityBox").on("click", (function () { c = $(this).html(), h(c), e.hide(), t.show(), $(".curCity").text(c) })), $(".questionPage .change").on("click", (function () { t.hide(), e.show() })), $(".questionPage .questionList").on("click", "li", (function () { let e = $(this).index(); e > 0 && (l = l.children[e - 1].children[0], f(l)) })), $(".resultPage .again img").on("click", (function () { finishQuestion = !1, l = s, i.hide(), e.show() })), $(".resultPage .failBtn").on("click", (function () { n.show() })), $(".contactPage ").on("click", (function () { n.hide() })) } function h (e) { if ($(".questionList").empty(), "北京" == e || "广州" == e) for (let t = 0; t < CITY_LIST.length; t++)if (CITY_LIST[t].name == e) { let e = CITY_LIST[t].question[0].children[0]; return s = e, l = s, void f(l) } let t = o[e]; $.ajax({ url: t, type: "get", dataType: "jsonp", scriptCharset: "GBK", jsonpCallback: "jqueryCallback", success: function (e) { s = e[0].children[0], l = s, f(l) } }) } function f (e) { let n = ""; if (0 === e.children.length) e.name.indexOf("您不能购买住宅") > -1 || e.name.indexOf("无资格") > -1 ? (n = "<div>很遗憾</div>", $(".report .succBox").hide(), $(".report .failBox").show()) : (n = "<div>祝贺您</div>", $(".report .succBox").show(), $(".report .failBox").hide()), n += '<div style="width:450px;">' + e.name + "</div>", $(".result").html(n), t.hide(), i.show(); else { n = "<li>·&nbsp;&nbsp;" + e.name + "&nbsp;&nbsp;·</li>"; for (let t = 0; t < e.children.length; t++)n += "<li>" + e.children[t].name + "</li>"; $(".questionList").html(n) } } console.log("原始url：" + document.location.href), console.log("原始城市参数：" + u.city), "micromessenger" == navigator.userAgent.toLowerCase().match(/MicroMessenger/i) ? function () { u = a(), console.log("微信初始化前url：" + document.location.href), console.log("微信初始化城市参数：" + u.city); let e = ""; try { e = u.code } catch (e) { alert("code捕获异常") } if ($.ajax({ type: "get", dataType: "jsonp", data: { appId: "wx1f343894d9cce45d", code: e, isAuth: !0 }, url: "https://game.house.163.com/web/user/wx/init2", success: function (e) { console.log("获取token：", e), e.token && "undefined" !== e.token && (userinfo = { name: e.nickname, headUrl: e.headUrl, token: e.token }, $.cookie("userinfo", JSON.stringify(userinfo), { expires: 1 }), d()) } }), e && "" !== e) $.ajax({ type: "get", dataType: "jsonp", data: { appId: "wx1f343894d9cce45d", code: e, isAuth: !0 }, url: "https://game.house.163.com/web/user/wx/init2", success: function (e) { console.log(e), e.token && "undefined" !== e.token && (userinfo = { name: e.nickname, headUrl: e.headUrl, token: e.token }, $.cookie("userinfo", JSON.stringify(userinfo), { expires: 1 }), d()) } }); else { let e = u.debug ? window.location.href.replace(/\?.*!/g, "") + "?debug=true" : window.location.href.replace(/\?.*/g, ""); u.city ? window.location.href = "https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx1f343894d9cce45d&redirect_uri=" + encodeURIComponent(e) + "&response_type=code&scope=snsapi_userinfo&state=1&connect_redirect=1#wechat_redirect&city=" + u.city : window.location.href = "https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx1f343894d9cce45d&redirect_uri=" + encodeURIComponent(e) + "&response_type=code&scope=snsapi_userinfo&state=1&connect_redirect=1#wechat_redirect" } u = a(), console.log("微信初始化后url：" + document.location.href), console.log("微信初始化后城市参数：" + u.city) }() : d() }();